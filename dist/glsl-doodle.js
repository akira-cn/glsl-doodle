!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.Doodle=n():e.Doodle=n()}(globalThis,(function(){return function(e){var n=globalThis.webpackHotUpdate;globalThis.webpackHotUpdate=function(e,t){!function(e,n){if(!y[e]||!x[e])return;for(var t in x[e]=!1,n)Object.prototype.hasOwnProperty.call(n,t)&&(p[t]=n[t]);0==--_&&0===b&&F()}(e,t),n&&n(e,t)};var t,r=!0,o="8a425531b722f25773b4",a={},i=[],s=[];function c(e){var n=S[e];if(!n)return U;var r=function(r){return n.hot.active?(S[r]?-1===S[r].parents.indexOf(e)&&S[r].parents.push(e):(i=[e],t=r),-1===n.children.indexOf(r)&&n.children.push(r)):(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),i=[]),U(r)},o=function(e){return{configurable:!0,enumerable:!0,get:function(){return U[e]},set:function(n){U[e]=n}}};for(var a in U)Object.prototype.hasOwnProperty.call(U,a)&&"e"!==a&&"t"!==a&&Object.defineProperty(r,a,o(a));return r.e=function(e){return"ready"===l&&f("prepare"),b++,U.e(e).then(n,(function(e){throw n(),e}));function n(){b--,"prepare"===l&&(g[e]||D(e),0===b&&0===_&&F())}},r.t=function(e,n){return 1&n&&(e=r(e)),U.t(e,-2&n)},r}function d(n){var r={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:t!==n,active:!0,accept:function(e,n){if(void 0===e)r._selfAccepted=!0;else if("function"==typeof e)r._selfAccepted=e;else if("object"==typeof e)for(var t=0;t<e.length;t++)r._acceptedDependencies[e[t]]=n||function(){};else r._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)r._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)r._declinedDependencies[e[n]]=!0;else r._declinedDependencies[e]=!0},dispose:function(e){r._disposeHandlers.push(e)},addDisposeHandler:function(e){r._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=r._disposeHandlers.indexOf(e);n>=0&&r._disposeHandlers.splice(n,1)},invalidate:function(){switch(this._selfInvalidated=!0,l){case"idle":(p={})[n]=e[n],f("ready");break;case"ready":A(n);break;case"prepare":case"check":case"dispose":case"apply":(m=m||[]).push(n)}},check:E,apply:T,status:function(e){if(!e)return l;u.push(e)},addStatusHandler:function(e){u.push(e)},removeStatusHandler:function(e){var n=u.indexOf(e);n>=0&&u.splice(n,1)},data:a[n]};return t=void 0,r}var u=[],l="idle";function f(e){l=e;for(var n=0;n<u.length;n++)u[n].call(null,e)}var v,p,h,m,_=0,b=0,g={},x={},y={};function w(e){return+e+""===e?+e:e}function E(e){if("idle"!==l)throw new Error("check() is only allowed in idle status");return r=e,f("check"),(n=1e4,n=n||1e4,new Promise((function(e,t){if("undefined"==typeof XMLHttpRequest)return t(new Error("No browser support"));try{var r=new XMLHttpRequest,a=U.p+""+o+".hot-update.json";r.open("GET",a,!0),r.timeout=n,r.send(null)}catch(e){return t(e)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)t(new Error("Manifest request to "+a+" timed out."));else if(404===r.status)e();else if(200!==r.status&&304!==r.status)t(new Error("Manifest request to "+a+" failed."));else{try{var n=JSON.parse(r.responseText)}catch(e){return void t(e)}e(n)}}}))).then((function(e){if(!e)return f(R()?"ready":"idle"),null;x={},g={},y=e.c,h=e.h,f("prepare");var n=new Promise((function(e,n){v={resolve:e,reject:n}}));p={};return D(0),"prepare"===l&&0===b&&0===_&&F(),n}));var n}function D(e){y[e]?(x[e]=!0,_++,function(e){var n=document.createElement("script");n.charset="utf-8",n.src=U.p+""+e+"."+o+".hot-update.js",document.head.appendChild(n)}(e)):g[e]=!0}function F(){f("ready");var e=v;if(v=null,e)if(r)Promise.resolve().then((function(){return T(r)})).then((function(n){e.resolve(n)}),(function(n){e.reject(n)}));else{var n=[];for(var t in p)Object.prototype.hasOwnProperty.call(p,t)&&n.push(w(t));e.resolve(n)}}function T(n){if("ready"!==l)throw new Error("apply() is only allowed in ready status");return function n(r){var s,c,d,u,l;function v(e){for(var n=[e],t={},r=n.map((function(e){return{chain:[e],id:e}}));r.length>0;){var o=r.pop(),a=o.id,i=o.chain;if((u=S[a])&&(!u.hot._selfAccepted||u.hot._selfInvalidated)){if(u.hot._selfDeclined)return{type:"self-declined",chain:i,moduleId:a};if(u.hot._main)return{type:"unaccepted",chain:i,moduleId:a};for(var s=0;s<u.parents.length;s++){var c=u.parents[s],d=S[c];if(d){if(d.hot._declinedDependencies[a])return{type:"declined",chain:i.concat([c]),moduleId:a,parentId:c};-1===n.indexOf(c)&&(d.hot._acceptedDependencies[a]?(t[c]||(t[c]=[]),_(t[c],[a])):(delete t[c],n.push(c),r.push({chain:i.concat([c]),id:c})))}}}}return{type:"accepted",moduleId:e,outdatedModules:n,outdatedDependencies:t}}function _(e,n){for(var t=0;t<n.length;t++){var r=n[t];-1===e.indexOf(r)&&e.push(r)}}R();var b={},g=[],x={},E=function(){console.warn("[HMR] unexpected require("+F.moduleId+") to disposed module")};for(var D in p)if(Object.prototype.hasOwnProperty.call(p,D)){var F;l=w(D),F=p[D]?v(l):{type:"disposed",moduleId:D};var T=!1,A=!1,O=!1,k="";switch(F.chain&&(k="\nUpdate propagation: "+F.chain.join(" -> ")),F.type){case"self-declined":r.onDeclined&&r.onDeclined(F),r.ignoreDeclined||(T=new Error("Aborted because of self decline: "+F.moduleId+k));break;case"declined":r.onDeclined&&r.onDeclined(F),r.ignoreDeclined||(T=new Error("Aborted because of declined dependency: "+F.moduleId+" in "+F.parentId+k));break;case"unaccepted":r.onUnaccepted&&r.onUnaccepted(F),r.ignoreUnaccepted||(T=new Error("Aborted because "+l+" is not accepted"+k));break;case"accepted":r.onAccepted&&r.onAccepted(F),A=!0;break;case"disposed":r.onDisposed&&r.onDisposed(F),O=!0;break;default:throw new Error("Unexception type "+F.type)}if(T)return f("abort"),Promise.reject(T);if(A)for(l in x[l]=p[l],_(g,F.outdatedModules),F.outdatedDependencies)Object.prototype.hasOwnProperty.call(F.outdatedDependencies,l)&&(b[l]||(b[l]=[]),_(b[l],F.outdatedDependencies[l]));O&&(_(g,[F.moduleId]),x[l]=E)}var P,B=[];for(c=0;c<g.length;c++)l=g[c],S[l]&&S[l].hot._selfAccepted&&x[l]!==E&&!S[l].hot._selfInvalidated&&B.push({module:l,parents:S[l].parents.slice(),errorHandler:S[l].hot._selfAccepted});f("dispose"),Object.keys(y).forEach((function(e){!1===y[e]&&function(e){delete installedChunks[e]}(e)}));var I,L,C=g.slice();for(;C.length>0;)if(l=C.pop(),u=S[l]){var M={},N=u.hot._disposeHandlers;for(d=0;d<N.length;d++)(s=N[d])(M);for(a[l]=M,u.hot.active=!1,delete S[l],delete b[l],d=0;d<u.children.length;d++){var j=S[u.children[d]];j&&((P=j.parents.indexOf(l))>=0&&j.parents.splice(P,1))}}for(l in b)if(Object.prototype.hasOwnProperty.call(b,l)&&(u=S[l]))for(L=b[l],d=0;d<L.length;d++)I=L[d],(P=u.children.indexOf(I))>=0&&u.children.splice(P,1);f("apply"),void 0!==h&&(o=h,h=void 0);for(l in p=void 0,x)Object.prototype.hasOwnProperty.call(x,l)&&(e[l]=x[l]);var G=null;for(l in b)if(Object.prototype.hasOwnProperty.call(b,l)&&(u=S[l])){L=b[l];var H=[];for(c=0;c<L.length;c++)if(I=L[c],s=u.hot._acceptedDependencies[I]){if(-1!==H.indexOf(s))continue;H.push(s)}for(c=0;c<H.length;c++){s=H[c];try{s(L)}catch(e){r.onErrored&&r.onErrored({type:"accept-errored",moduleId:l,dependencyId:L[c],error:e}),r.ignoreErrored||G||(G=e)}}}for(c=0;c<B.length;c++){var Y=B[c];l=Y.module,i=Y.parents,t=l;try{U(l)}catch(e){if("function"==typeof Y.errorHandler)try{Y.errorHandler(e)}catch(n){r.onErrored&&r.onErrored({type:"self-accept-error-handler-errored",moduleId:l,error:n,originalError:e}),r.ignoreErrored||G||(G=n),G||(G=e)}else r.onErrored&&r.onErrored({type:"self-accept-errored",moduleId:l,error:e}),r.ignoreErrored||G||(G=e)}}if(G)return f("fail"),Promise.reject(G);if(m)return n(r).then((function(e){return g.forEach((function(n){e.indexOf(n)<0&&e.push(n)})),e}));return f("idle"),new Promise((function(e){e(g)}))}(n=n||{})}function R(){if(m)return p||(p={}),m.forEach(A),m=void 0,!0}function A(n){Object.prototype.hasOwnProperty.call(p,n)||(p[n]=e[n])}var S={};function U(n){if(S[n])return S[n].exports;var t=S[n]={i:n,l:!1,exports:{},hot:d(n),parents:(s=i,i=[],s),children:[]};return e[n].call(t.exports,t,t.exports,c(n)),t.l=!0,t.exports}return U.m=e,U.c=S,U.d=function(e,n,t){U.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},U.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},U.t=function(e,n){if(1&n&&(e=U(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(U.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)U.d(t,r,function(n){return e[n]}.bind(null,r));return t},U.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return U.d(n,"a",n),n},U.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},U.p="/js/",U.h=function(){return o},c(14)(U.s=14)}([function(e,n,t){e.exports=t(24)},function(e,n,t){var r=t(21),o=t(22),a=t(11),i=t(23);e.exports=function(e,n){return r(e)||o(e,n)||a(e,n)||i()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){function t(e,n,t,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(r,o)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(o,a){var i=e.apply(n,r);function s(e){t(i,o,a,s,c,"next",e)}function c(e){t(i,o,a,s,c,"throw",e)}s(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n,t){var r=t(15),o=t(16),a=t(11),i=t(17);e.exports=function(e){return r(e)||o(e)||a(e)||i()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){e.exports=function(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.default=e.exports,e.exports.__esModule=!0,t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){e.exports=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){function t(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n,t){var r=t(18);function o(n,t,a){return"undefined"!=typeof Reflect&&Reflect.get?(e.exports=o=Reflect.get,e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=o=function(e,n,t){var o=r(e,n);if(o){var a=Object.getOwnPropertyDescriptor(o,n);return a.get?a.get.call(t):a.value}},e.exports.default=e.exports,e.exports.__esModule=!0),o(n,t,a||n)}e.exports=o,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){e.exports=function(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n,t){var r=t(10);e.exports=function(e,n){if(e){if("string"==typeof e)return r(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?r(e,n):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n,t){var r=t(19);e.exports=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&r(e,n)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n,t){var r=t(9).default,o=t(20);e.exports=function(e,n){if(n&&("object"===r(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return o(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n,t){"use strict";t.r(n);var r=t(25).default;r.autoLoad(),n.default=r},function(e,n,t){var r=t(10);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n,t){var r=t(5);e.exports=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=r(e)););return e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},e.exports.default=e.exports,e.exports.__esModule=!0,t(n,r)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){e.exports=function(e){if(Array.isArray(e))return e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){e.exports=function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,a=[],i=!0,s=!1;try{for(t=t.call(e);!(i=(r=t.next()).done)&&(a.push(r.value),!n||a.length!==n);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==t.return||t.return()}finally{if(s)throw o}}return a}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,n,t){var r=function(e){"use strict";var n=Object.prototype,t=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function s(e,n,t){return Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[n]}try{s({},"")}catch(e){s=function(e,n,t){return e[n]=t}}function c(e,n,t,r){var o=n&&n.prototype instanceof l?n:l,a=Object.create(o.prototype),i=new E(r||[]);return a._invoke=function(e,n,t){var r="suspendedStart";return function(o,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw a;return F()}for(t.method=o,t.arg=a;;){var i=t.delegate;if(i){var s=x(i,t);if(s){if(s===u)continue;return s}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===r)throw r="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);r="executing";var c=d(e,n,t);if("normal"===c.type){if(r=t.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:t.done}}"throw"===c.type&&(r="completed",t.method="throw",t.arg=c.arg)}}}(e,t,i),a}function d(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function l(){}function f(){}function v(){}var p={};s(p,o,(function(){return this}));var h=Object.getPrototypeOf,m=h&&h(h(D([])));m&&m!==n&&t.call(m,o)&&(p=m);var _=v.prototype=l.prototype=Object.create(p);function b(e){["next","throw","return"].forEach((function(n){s(e,n,(function(e){return this._invoke(n,e)}))}))}function g(e,n){var r;this._invoke=function(o,a){function i(){return new n((function(r,i){!function r(o,a,i,s){var c=d(e[o],e,a);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&t.call(l,"__await")?n.resolve(l.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):n.resolve(l).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}(o,a,r,i)}))}return r=r?r.then(i,i):i()}}function x(e,n){var t=e.iterator[n.method];if(void 0===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=void 0,x(e,n),"throw"===n.method))return u;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=d(t,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,u;var o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,u):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,u)}function y(e){var n={tryLoc:e[0]};1 in e&&(n.catchLoc=e[1]),2 in e&&(n.finallyLoc=e[2],n.afterLoc=e[3]),this.tryEntries.push(n)}function w(e){var n=e.completion||{};n.type="normal",delete n.arg,e.completion=n}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(y,this),this.reset(!0)}function D(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function n(){for(;++r<e.length;)if(t.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=void 0,n.done=!0,n};return a.next=a}}return{next:F}}function F(){return{value:void 0,done:!0}}return f.prototype=v,s(_,"constructor",v),s(v,"constructor",f),f.displayName=s(v,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===f||"GeneratorFunction"===(n.displayName||n.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,s(e,i,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},b(g.prototype),s(g.prototype,a,(function(){return this})),e.AsyncIterator=g,e.async=function(n,t,r,o,a){void 0===a&&(a=Promise);var i=new g(c(n,t,r,o),a);return e.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},b(_),s(_,i,"Generator"),s(_,o,(function(){return this})),s(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var n=[];for(var t in e)n.push(t);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=D,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var n in this)"t"===n.charAt(0)&&t.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(t,r){return i.type="throw",i.arg=e,n.next=t,r&&(n.method="next",n.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=t.call(a,"catchLoc"),c=t.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,n){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&t.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=n&&n<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=n,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(i)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),u},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),w(t),u}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===e){var r=t.completion;if("throw"===r.type){var o=r.arg;w(t)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,t){return this.delegate={iterator:D(e),resultName:n,nextLoc:t},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return Y}));var r=t(3),o=t.n(r),a=t(2),i=t.n(a),s=t(6),c=t.n(s),d=t(7),u=t.n(d),l=t(8),f=t.n(l),v=t(12),p=t.n(v),h=t(13),m=t.n(h),_=t(5),b=t.n(_),g=t(4),x=t.n(g),y=t(1),w=t.n(y),E=t(0),D=t.n(E),F=t(9),T=t.n(F);function R(e,n){var t=function(e,n){for(var t=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null,o=0;o<t.length;++o){try{r=e.getContext(t[o],n)}catch(e){}if(r)break}return r}(e,n);if(!t)throw new Error("Sorry, your browser doesn't support WebGL.");return t}function A(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Float32Array,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t&&!(t instanceof n))throw new TypeError("Wrong buffer type.");if(null==e)return e;if(e instanceof n)return e;if(null==e[0]||null==e[0].length)return t?(t.set(e,0),t):new n(e);var r=e[0].length,o=e.length;t||(t=new n(r*o));for(var a=0,i=0;i<o;i++)for(var s=0;s<r;s++)t[a++]=e[i][s];return t}var S={};var U={};function O(){return(O=i()(D.a.mark((function e(n){var t,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!U[n]){e.next=2;break}return e.abrupt("return",U[n]);case 2:return e.next=4,fetch(n);case 4:if(!((t=e.sent).status>=200&&t.status<300)){e.next=11;break}return e.next=8,t.text();case 8:return r=e.sent,U[n]=r,e.abrupt("return",r);case 11:throw new Error("Shader loaded error.");case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k="#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvoid main() {\n  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.1);\n}",P={};function B(e,n,t){return e.activeTexture(e.TEXTURE0+t),Array.isArray(n._img)?e.bindTexture(e.TEXTURE_CUBE_MAP,n):e.bindTexture(e.TEXTURE_2D,n),n}var I={int:"1i",ivec2:"2i",ivec3:"3i",ivec4:"4i",float:"1f",vec2:"2f",vec3:"3f",vec4:"4f",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler1D:"sampler1D",sampler2D:"sampler2D",sampler3D:"sampler3D",samplerCube:"samplerCube",sampler1DShadow:"sampler1DShadow",sampler2DShadow:"sampler2DShadow",sampler2DRect:"sampler2DRect",sampler2DRectShadow:"sampler2DRectShadow"},L=function(){function e(n){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c()(this,e),this.options=Object.assign({},e.defaultOptions,r),this.canvas=n,this.options.webgl2&&(t=n.getContext("webgl2",this.options)),null==t&&(t=R(n,this.options),this.aia_ext=t.getExtension("ANGLE_instanced_arrays")),this.gl=t,t.viewport(0,0,n.width,n.height),t.clearColor(0,0,0,0),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),this.programs=[],this._events={}}var n,t,r;return u()(e,[{key:"program",get:function(){var e=this.gl;return e.getParameter(e.CURRENT_PROGRAM)}},{key:"_declareUniform",value:function(e,n){var t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"1f",a=this.gl,i=a.getUniformLocation(e,n),s=this;if(/^sampler/.test(r)){var c=e._samplerMap,d=e._bindTextures;Object.defineProperty(e.uniforms,n,{get:function(){return t},set:function(e){t=e;var r=null!=c[n]?c[n]:d.length;d[r]=e,B(a,e,r),c[n]||(c[n]=r,a.uniform1i(i,r)),s.options.autoUpdate&&s.update()},configurable:!1,enumerable:!0})}else{var u=0===r.indexOf("Matrix"),l=!u&&/v$/.test(r),f=a["uniform".concat(r)].bind(a);Object.defineProperty(e.uniforms,n,{get:function(){return t},set:function(e){t=e,"number"==typeof e&&(e=[e]),u?f(i,!1,e):l?f(i,e):f.apply(void 0,[i].concat(o()(e))),s.options.autoUpdate&&s.update()},configurable:!1,enumerable:!0})}}},{key:"_draw",value:function(){var n=this,t=this.program;t.meshData.forEach((function(r,o){var a=r.positions,i=r.cells,s=r.instanceCount,c=r.cellsCount,d=r.attributes,u=r.uniforms,l=r.textureCoord,f=r.enableBlend,v=n.gl,p=null!=r.mode?r.mode:v.TRIANGLES;"string"==typeof p&&(p=v[p]),f?v.enable(v.BLEND):v.disable(v.BLEND),v.bindBuffer(v.ARRAY_BUFFER,t._buffers.verticesBuffer),v.bufferData(v.ARRAY_BUFFER,a,v.STATIC_DRAW),i&&(v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,t._buffers.cellsBuffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,i,v.STATIC_DRAW));var h,m=[];if(d&&Object.values(d).forEach((function(e){var r=e.name,o=e.data,a=e.divisor;if(v.bindBuffer(v.ARRAY_BUFFER,t._buffers[r]),v.bufferData(v.ARRAY_BUFFER,o,v.STATIC_DRAW),null!=a){var i=v.getAttribLocation(t,r);i>=0&&(v.enableVertexAttribArray(i),m.push(i),v.vertexAttribDivisor?v.vertexAttribDivisor(i,a):n.aia_ext&&n.aia_ext.vertexAttribDivisorANGLE(i,a))}})),u&&Object.entries(u).forEach((function(e){var t=w()(e,2),r=t[0],o=t[1];n.uniforms[r]=o})),!i){var _=t._dimension;h=a.length/_}if(t._enableTextures&&t._buffers.texCoordBuffer){var b=l||function(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,t=[],r=e.length,o=0;o<r;o++)o%n<2&&t.push(.5*(e[o]+1));return t}(a,t._dimension);v.bindBuffer(v.ARRAY_BUFFER,t._buffers.texCoordBuffer),v.bufferData(v.ARRAY_BUFFER,e.FLOAT(b),v.STATIC_DRAW)}null!=s?(i?v.drawElementsInstanced?v.drawElementsInstanced(p,c,v.UNSIGNED_SHORT,0,s):n.aia_ext&&n.aia_ext.drawElementsInstancedANGLE(p,c,v.UNSIGNED_SHORT,0,s):v.drawArraysInstanced?v.drawArraysInstanced(p,0,h,s):n.aia_ext.drawArraysInstancedANGLE(p,0,h,s),m.forEach((function(e){v.vertexAttribDivisor?v.vertexAttribDivisor(e,null):n.aia_ext&&n.aia_ext.vertexAttribDivisorANGLE(e,null)}))):i?v.drawElements(p,c,v.UNSIGNED_SHORT,0):v.drawArrays(p,0,h)}))}},{key:"isWebGL2",get:function(){return"undefined"!=typeof WebGL2RenderingContext&&this.gl instanceof WebGL2RenderingContext}},{key:"enableTextures",get:function(){return this.program&&this.program._enableTextures}},{key:"uniforms",get:function(){var e=this.program;if(!e||!e.uniforms)throw Error("No avaliable program.");return e.uniforms}},{key:"deleteProgram",value:function(e){var n=this.gl;this.program===e&&(this.startRender=!1,this._renderFrameID&&(cancelAnimationFrame(this._renderFrameID),delete this._renderFrameID),n.useProgram(null));var t=this.programs.indexOf(e);t>=0&&this.programs.splice(t,1),function(e,n){var t=n._buffers;Object.values(t).forEach((function(n){e.deleteBuffer(n)})),n._buffers={}}(n,e),n.deleteProgram(e)}},{key:"setMeshData",value:function(n){var t=this;Array.isArray(n)||(n=[n]);var r=this.program;r.meshData=n.map((function(n){var o=n.mode,a=n.positions,i=n.instanceCount,s=n.cells,c=n.cellsCount,d=n.attributes,u=n.uniforms,l=n.textureCoord,f=n.enableBlend,v={positions:e.FLOAT(a),uniforms:u,enableBlend:!!f,textureCoord:e.FLOAT(l)};if(s&&(v.cells=e.USHORT(s),v.cellsCount=c||v.cells.length),null!=o&&(v.mode=o),null!=i){if(!t.isWebGL2&&!t.aia_ext)throw new Error("Cannot use instanceCount in this rendering context, use webgl2 context instead.");v.instanceCount=i}if(d){var p={};Object.entries(d).forEach((function(n){var o=w()(n,2),a=o[0],i=o[1];if(r._attribute[a]){if("ignored"!==r._attribute[a]){var s=r._attribute[a],c=s.name,d=s.type,u=i.data||i;if(Array.isArray(u)&&(u=e[d](u)),p[a]={name:c,data:u},null!=i.divisor){if(!t.isWebGL2&&!t.aia_ext)throw new Error("Cannot use divisor in this rendering context, use webgl2 context instead.");p[a].divisor=i.divisor}}}else __DEV__&&console.warn("Ignored attribute ".concat(a,".")),r._attribute[a]="ignored"})),v.attributes=p}return v})),this.options.autoUpdate&&this.update()}},{key:"createProgram",value:function(e,n){var t=this,r=/^\s*uniform\s+sampler/gm.test(e);null==e&&(e=this.options.webgl2?"#version 300 es\nprecision highp float;\nprecision highp int;\n\nout vec4 FragColor;\nvoid main() {\n  FragColor = vec4(0.0, 0.0, 0.0, 0.1);\n}":k),null==n&&(n=r?"attribute vec4 a_vertexPosition;\nattribute vec2 a_vertexTextureCoord;\nvarying vec2 vTextureCoord;\n\nvoid main() {\n  gl_PointSize = 1.0;\n  gl_Position = a_vertexPosition;\n  vTextureCoord = a_vertexTextureCoord;\n}":"attribute vec3 a_vertexPosition;\n\nvoid main() {\n  gl_PointSize = 1.0;\n  gl_Position = vec4(a_vertexPosition, 1);\n}",this.options.webgl2&&(n=r?"#version 300 es\nprecision highp float;\nprecision highp int;\n\nin vec4 a_vertexPosition;\nin vec2 a_vertexTextureCoord;\n\nout vec2 vTextureCoord;\n\nvoid main() {\n  gl_PointSize = 1.0;\n  gl_Position = a_vertexPosition;\n  vTextureCoord = a_vertexTextureCoord;\n}":"#version 300 es\nprecision highp float;\nprecision highp int;\n\nin vec3 a_vertexPosition;\n\nvoid main() {\n  gl_PointSize = 1.0;\n  gl_Position = vec4(a_vertexPosition, 1);\n}"));var o=this.gl,a=function(e,n,t){var r=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var o="Vertex shader failed to compile.  The error log is:".concat(e.getShaderInfoLog(r));throw new Error(o)}var a=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS)){var i="Fragment shader failed to compile.  The error log is:".concat(e.getShaderInfoLog(a));throw new Error(i)}var s=e.createProgram();if(e.attachShader(s,r),e.attachShader(s,a),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){var c="Shader program failed to link.  The error log is:".concat(e.getProgramInfoLog(s));throw new Error(c)}return e.deleteShader(r),e.deleteShader(a),s}(o,n,e);a.shaderText={vertexShader:n,fragmentShader:e},a._buffers={},a._attribute={},a.uniforms={},a._samplerMap={},a._bindTextures=[];var i=new RegExp("(?:attribute|in) vec(\\d) ".concat(this.options.vertexPosition),"im"),s=n.match(i);s&&(a._dimension=Number(s[1]));var c=new RegExp("(?:attribute|in) vec(\\d) ".concat(this.options.vertexTextureCoord),"im");(s=n.match(c))&&(a._texCoordSize=Number(s[1]));if(s=n.match(/^\s*(?:attribute|in) (\w+?)(\d*) (\w+)/gim))for(var d=0;d<s.length;d++){var u=s[d].match(/^\s*(?:attribute|in) (\w+?)(\d*) (\w+)/im);if(u&&u[3]!==this.options.vertexPosition&&u[3]!==this.options.vertexTextureCoord){var l=w()(u,4),f=l[1],v=l[2],p=l[3];"mat"===f&&(v=Math.pow(v,2)),a._buffers[p]=o.createBuffer(),a._attribute[p]={name:p,type:f,size:Number(v)||1}}}var h=/^\s*uniform\s+(\w+)\s+(\w+)(\[\d+\])?/gm;(s=(s=n.match(h)||[]).concat(e.match(h)||[])).forEach((function(e){var n=e.match(/^\s*uniform\s+(\w+)\s+(\w+)(\[\d+\])?/).slice(1),r=w()(n,3),o=r[0],i=r[1],s=r[2];s=!!s,0!==(o=I[o]).indexOf("Matrix")&&s&&(o+="v"),t._declareUniform(a,i,o)})),a._buffers.verticesBuffer=o.createBuffer(),a._buffers.cellsBuffer=o.createBuffer();var m=o.getAttribLocation(a,this.options.vertexTextureCoord);return a._enableTextures=m>=0,a._enableTextures&&(a._buffers.texCoordBuffer=o.createBuffer()),this.programs.push(a),a}},{key:"useProgram",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.startRender=!1,this._renderFrameID&&(cancelAnimationFrame(this._renderFrameID),delete this._renderFrameID);var t=this.gl;t.useProgram(e);var r=e._dimension;t.bindBuffer(t.ARRAY_BUFFER,e._buffers.verticesBuffer);var o=t.getAttribLocation(e,this.options.vertexPosition);if(t.vertexAttribPointer(o,r,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o),e._enableTextures){t.bindBuffer(t.ARRAY_BUFFER,e._buffers.texCoordBuffer);var a=t.getAttribLocation(e,this.options.vertexTextureCoord);t.vertexAttribPointer(a,e._texCoordSize||2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a)}if(Object.entries(e._attribute).forEach((function(r){var o=w()(r,2),a=o[0],i=o[1];if("ignored"!==i){var s=i.size,c=n[a]||{},d=!!c.normalize,u=c.type||"FLOAT",l=c.key||a;"UBYTE"===u&&(u="UNSIGNED_BYTE"),"USHORT"===u&&(u="UNSIGNED_SHORT"),i.type=u,l&&l!==a&&(e._attribute[l]=i),t.bindBuffer(t.ARRAY_BUFFER,e._buffers[a]);var f=t.getAttribLocation(e,a);f>=0&&(t.vertexAttribPointer(f,s,t[u],d,0,0),t.enableVertexAttribArray(f))}})),!e.meshData){var i=[[-1,-1,0,1].slice(0,r),[1,-1,0,1].slice(0,r),[1,1,0,1].slice(0,r),[-1,1,0,1].slice(0,r)],s=[[0,1,3],[3,1,2]];this.setMeshData({positions:i,cells:s})}return e}},{key:"compileSync",value:function(e,n){var t={};function r(e){var n=[],o=(e=e.replace(/^\s*/gm,"")).match(/^#pragma\s+include\s+.*/gm);if(o){for(var a=0;a<o.length;a++){var i=o[a].match(/(?:<|")(.*)(?:>|")/);if(i){var s=0===i[0].indexOf("<")?"lib":"link",c=i[1];if("graph"===c&&(c="graphics"),t[c])n.push("/* included ".concat(c," */"));else if(t[c]=!0,"lib"===s){var d=r(P[c]);n.push(d)}else if("link"===s)throw new Error("Cannot load external links synchronously. Use compile instead of compileSync.")}}n.forEach((function(n){e=e.replace(/^#pragma\s+include\s+.*/m,n)}))}return e}var o=r(e=e||k),a=n?r(n):null;return this.createProgram(o,a)}},{key:"compile",value:(r=i()(D.a.mark((function n(t,r){var o,a,s,c,d,u;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=function(){return(s=i()(D.a.mark((function n(t){var r,i,s,c,d,u,l,f,v;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=t.replace(/^\s*/gm,""),r=[],!(i=t.match(/^#pragma\s+include\s+.*/gm))){n.next=36;break}s=0;case 5:if(!(s<i.length)){n.next=35;break}if(c=i[s],!(d=c.match(/(?:<|")(.*)(?:>|")/))){n.next=32;break}if(u=0===d[0].indexOf("<")?"lib":"link","graph"===(l=d[1])&&(l="graphics"),o[l]){n.next=31;break}if(o[l]=!0,"lib"!==u){n.next=21;break}return n.next=17,a(P[l]);case 17:f=n.sent,r.push(f),n.next=29;break;case 21:if("link"!==u){n.next=29;break}return n.next=24,e.fetchShader(l);case 24:return v=n.sent,n.next=27,a(v);case 27:v=n.sent,r.push(v);case 29:n.next=32;break;case 31:r.push("/* included ".concat(l," */"));case 32:s++,n.next=5;break;case 35:r.forEach((function(e){t=t.replace(/^#pragma\s+include\s+.*/m,e)}));case 36:return n.abrupt("return",t);case 37:case"end":return n.stop()}}),n)})))).apply(this,arguments)},a=function(e){return s.apply(this,arguments)},t=t||k,o={},n.next=6,a(t);case 6:if(c=n.sent,!r){n.next=13;break}return n.next=10,a(r);case 10:n.t0=n.sent,n.next=14;break;case 13:n.t0=null;case 14:return d=n.t0,u=this.createProgram(c,d),n.abrupt("return",u);case 17:case"end":return n.stop()}}),n,this)}))),function(e,n){return r.apply(this,arguments)})},{key:"load",value:(t=i()(D.a.mark((function n(t){var r,o=arguments;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:null,n.next=3,e.fetchShader(t);case 3:if(t=n.sent,!r){n.next=8;break}return n.next=7,e.fetchShader(r);case 7:r=n.sent;case 8:return n.abrupt("return",this.compile(t,r));case 9:case"end":return n.stop()}}),n,this)}))),function(e){return t.apply(this,arguments)})},{key:"createTexture",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.wrapS,o=void 0===r?this.gl.CLAMP_TO_EDGE:r,a=t.wrapT,i=void 0===a?this.gl.CLAMP_TO_EDGE:a,s=t.minFilter,c=void 0===s?this.gl.LINEAR:s,d=t.magFilter,u=void 0===d?this.gl.LINEAR:d,l=this.gl,f=Array.isArray(n)?l.TEXTURE_CUBE_MAP:l.TEXTURE_2D;this._max_texture_image_units=this._max_texture_image_units||l.getParameter(l.MAX_COMBINED_TEXTURE_IMAGE_UNITS),l.activeTexture(l.TEXTURE0+this._max_texture_image_units-1);var v=l.createTexture();l.bindTexture(f,v),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!0);var p=this.canvas,h=p.width,m=p.height;if(n)if(f===l.TEXTURE_CUBE_MAP)for(var _=0;_<6;_++)l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+_,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,n[_]);else l.texImage2D(f,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,n);else if(f===l.TEXTURE_CUBE_MAP)for(var b=0;b<6;b++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+b,0,l.RGBA,h,m,0,l.RGBA,l.UNSIGNED_BYTE,null);else l.texImage2D(f,0,l.RGBA,h,m,0,l.RGBA,l.UNSIGNED_BYTE,null);return l.texParameteri(f,l.TEXTURE_MIN_FILTER,c),l.texParameteri(f,l.TEXTURE_MAG_FILTER,u),l.texParameteri(f,l.TEXTURE_WRAP_S,o),l.texParameteri(f,l.TEXTURE_WRAP_T,i),f===l.TEXTURE_CUBE_MAP&&(n.width=n[0].width,n.height=n[0].height),l.bindTexture(f,null),v._img=n||{width:h,height:m},v.delete=function(){e.deleteTexture(v)},v}},{key:"deleteTexture",value:function(e){var n=e._img;this.gl.deleteTexture(e),"function"==typeof n.close&&n.close()}},{key:"loadTexture",value:(n=i()(D.a.mark((function n(t){var r,o,a,i,s=arguments;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},o=r.useImageBitmap,a=void 0===o||o,n.next=3,e.loadImage(t,{useImageBitmap:a});case 3:return i=n.sent,n.abrupt("return",this.createTexture(i));case 5:case"end":return n.stop()}}),n,this)}))),function(e){return n.apply(this,arguments)})},{key:"createFBO",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.color,t=void 0===n?1:n,r=e.blend,o=void 0!==r&&r,a=e.depth,i=void 0===a?!1!==this.options.depth:a,s=e.stencil,c=void 0===s?!!this.options.stencil:s,d=this.gl,u=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,u);for(var l=[],f=0;f<t;f++){var v=this.createTexture();d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0+f,d.TEXTURE_2D,v,0),l.push(v)}u.textures=l,u.texture=l[0],u.blend=o;var p=this.canvas,h=p.width,m=p.height;return i&&!c&&(u.depthBuffer=d.createRenderbuffer(),d.bindRenderbuffer(d.RENDERBUFFER,u.depthBuffer),d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,h,m),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,u.depthBuffer)),c&&!i&&(u.stencilBuffer=d.createRenderbuffer(),d.bindRenderbuffer(d.RENDERBUFFER,u.stencilBuffer),d.renderbufferStorage(d.RENDERBUFFER,d.STENCIL_INDEX8,h,m),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.STENCIL_ATTACHMENT,d.RENDERBUFFER,u.stencilBuffer)),i&&c&&(u.depthStencilBuffer=d.createRenderbuffer(),d.bindRenderbuffer(d.RENDERBUFFER,u.depthStencilBuffer),d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_STENCIL,h,m),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,u.depthStencilBuffer)),d.bindFramebuffer(d.FRAMEBUFFER,null),u}},{key:"bindFBO",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.fbo=e}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.clearBuffer;this.startRender=!0;var n=this.gl,t=this.program;t||(t=this.createProgram(),this.useProgram(t)),this.fbo&&n.bindFramebuffer(n.FRAMEBUFFER,this.fbo);var r=this.options.depth;r&&n.enable(n.DEPTH_TEST),this.gl.clear(this.gl.COLOR_BUFFER_BIT|(r?this.gl.DEPTH_BUFFER_BIT:0)|(this.options.stencil?this.gl.STENCIL_BUFFER_BIT:0));var o=this._renderFrameID;this._draw(),this.fbo&&n.bindFramebuffer(n.FRAMEBUFFER,null),this._renderFrameID===o&&(this._renderFrameID=null)}},{key:"update",value:function(){this.startRender&&null==this._renderFrameID&&(this._renderFrameID=requestAnimationFrame(this.render.bind(this)))}}],[{key:"addLibs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(P,e)}},{key:"FLOAT",value:function(e,n){return A(e,Float32Array,n)}},{key:"UNSIGNED_BYTE",value:function(e,n){return A(e,Uint8Array,n)}},{key:"UNSIGNED_SHORT",value:function(e,n){return A(e,Uint16Array,n)}},{key:"BYTE",value:function(e,n){return A(e,Int8Array,n)}},{key:"SHORT",value:function(e,n){return A(e,Int16Array,n)}}]),e}();x()(L,"defaultOptions",{preserveDrawingBuffer:!0,autoUpdate:!0,vertexPosition:"a_vertexPosition",vertexTextureCoord:"a_vertexTextureCoord",webgl2:!1}),x()(L,"UBYTE",L.UNSIGNED_BYTE),x()(L,"USHORT",L.UNSIGNED_SHORT),x()(L,"fetchShader",(function(e){return O.apply(this,arguments)})),x()(L,"loadImage",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.useImageBitmap,r=void 0===t||t,o=n.alias,a=void 0===o?null:o;if(!S[e])if("function"==typeof Image){var i=new Image;"string"!=typeof e||"object"===("undefined"==typeof location?"undefined":T()(location))&&/^file:/.test(location.href)||/^data:/.test(e)||(i.crossOrigin="anonymous"),S[e]=new Promise((function(n){i.onload=function(){r&&"function"==typeof createImageBitmap?createImageBitmap(i,{imageOrientation:"flipY"}).then((function(t){S[e]=t,a&&(S[a]=t),n(t)})):(S[e]=i,a&&(S[a]=i),n(i))},i.src=e})),a&&(S[a]=S[e])}else if("function"==typeof fetch)return fetch(e,{method:"GET",mode:"cors",cache:"default"}).then((function(e){return e.blob()})).then((function(n){return createImageBitmap(n,{imageOrientation:"flipY"}).then((function(n){return S[e]=n,a&&(S[a]=n),n}))}));return S[e]}));var C=L;function M(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=b()(e);if(n){var o=b()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return m()(this,t)}}C.addLibs({stdlib:"#ifndef M_STDLIB\n\n#define M_STDLIB\n\n#ifndef PI\n#define PI 3.141592653589793\n#endif\n\n#ifndef FLT_EPSILON\n#define FLT_EPSILON 0.000001\n#endif\n\n// https://math.stackexchange.com/questions/1098487/atan2-faster-approximation\nfloat atan2(float dy, float dx) {\n  float ax = abs(dx);\n  float ay = abs(dy);\n  float a = min(ax, ay) / (max(ax, ay) + FLT_EPSILON);\n  float s = a * a;\n  float r = ((-0.0464964749 * s + 0.15931422) * s - 0.327622764) * s * a + a;\n  if(ay > ax) r = 1.57079637 - r;\n  if(dx < 0.0) r = PI - r;\n  if(dy < 0.0) r = -r;\n  return r;\n}\n\nfloat atan2(vec2 v) {\n  return atan2(v.y, v.x);\n}\n\n/**\n  从 v1 相对 v2 的逆时针夹角, 0 ~ 2 * PI\n */\nfloat angle(vec2 v1, vec2 v2) {\n  float ang = atan2(v1) - atan2(v2);\n  if(ang < 0.0) ang += 2.0 * PI;\n  return ang;\n}\n\nfloat angle(vec2 v) {\n  return angle(v, vec2(1.0, 0.0));\n}\n\nvec2 center(vec2 v) {\n  return v * 0.5;\n}\n\nvec2 center(vec2 v1, vec2 v2) {\n  return (v1 + v2) * 0.5;\n}\n\nhighp float random(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\nhighp float random(vec2 st, float a, float b) {\n  highp float p = random(st);\n  return mix(a, b, p);\n}\n\nhighp vec2 random2(vec2 st){\n  highp vec2 v = vec2(dot(st, vec2(127.1, 311.7)), dot(st, vec2(269.5, 183.3)));\n  return -1.0 + 2.0 * fract(sin(v) * 43758.5453123);\n}\n\nhighp vec3 random3(vec2 st) {\n  highp vec3 v = vec3(random2(st), random(st));\n  return v;\n}\n\n// Value Noise by Inigo Quilez - iq/2013\n// https://www.shadertoy.com/view/lsf3WH\nhighp float noise(vec2 st) {\n    vec2 i = floor(st);\n    vec2 f = fract(st);\n    vec2 u = f * f * (3.0 - 2.0 * f);\n    return mix( mix( random( i + vec2(0.0,0.0) ),\n                     random( i + vec2(1.0,0.0) ), u.x),\n                mix( random( i + vec2(0.0,1.0) ),\n                     random( i + vec2(1.0,1.0) ), u.x), u.y);\n}\n\n// https://www.shadertoy.com/view/MdX3zr\n// Thx to Las^Mercury\nhighp float noise(vec3 p) {\n\tvec3 i = floor(p);\n\tvec4 a = dot(i, vec3(1.0, 57.0, 21.0)) + vec4(0.0, 57.0, 21.0, 78.0);\n\tvec3 f = cos((p - i) * acos(-1.0)) * (-0.5) + 0.5;\n\ta = mix(sin(cos(a) * a), sin(cos(1.0 + a) * (1.0 + a)), f.x);\n\ta.xy = mix(a.xz, a.yw, f.y);\n\treturn mix(a.x, a.y, f.z);\n}\n\n/**\n  将直角坐标转为极坐标\n */\nvec2 polar(vec2 st, vec2 c) {\n  vec2 p = c - st;\n  float r = length(p) * 2.0;\n  float a = atan(p.y, p.x);\n\n  return vec2(r, a);  \n}\n\nvec2 polar(vec2 st) {\n  return polar(st, vec2(0.5));\n}\n\n#endif",box:"#ifndef MOD_BOX\n\n#define MOD_BOX\n\n/**\n  box2 由四个点构成矩形或平行四边形\n */\nstruct box2 {\n  vec2 a;\n  vec2 b;\n  vec2 c;\n  vec2 d;\n};\n\n/**\n  求 box2 的中心点\n */\nvec2 center(box2 box) {\n  return (box.a + box.c) * 0.5;\n}\n\n/**\n  创建 box2\n\n  参数：\n    vec2 point  参考点\n    float w 宽\n    float h 高\n    vec2 anchro 锚\n\n  返回值：\n    box2\n */\nbox2 create_box(vec2 point, float w, float h, vec2 anchor) {\n  vec2 size = vec2(w, h);\n  vec2 a = point + size * (vec2(0.0) - anchor);\n  vec2 b = point + size * (vec2(1.0, 0.0) - anchor);\n  vec2 c = point + size * (vec2(1.0) - anchor);\n  vec2 d = point + size * (vec2(0.0, 1.0) - anchor);\n\n  return box2(a, b, c, d);  \n}\n\nbox2 create_box(vec2 point, float w, float h) {\n  return create_box(point, w, h, vec2(0.0));\n}\n\nbox2 create_box(vec2 point, float wh) {\n  return create_box(point, wh, wh, vec2(0.0));\n}\n\nbox2 create_box(float w, float h) {\n  return create_box(vec2(0.0), w, h, vec2(0.0));\n}\n\nbox2 create_box(float wh) {\n  return create_box(vec2(0.0), wh, wh, vec2(0.0));\n}\n\nbox2 create_box() {\n  return create_box(vec2(0.0), 1.0, 1.0, vec2(0.0));\n}\n\n/**\n  求一个坐标点 p 在 box 中的相对坐标值 （0 ~ 1）\n\n  参数：\n    vec2 p    坐标点\n    box2 box  当前 box 对象\n  \n  返回值：\n    vec2 单位坐标值\n */\nvec2 box_quad(vec2 p, box2 box) {\n  vec2 a = box.a;\n  vec2 b = box.b;\n  vec2 c = box.c;\n  vec2 d = box.d;\n\n  float d1 = sdf_line(p, a, b);\n  float d2 = sdf_line(p, b, c);\n  float d3 = sdf_line(p, c, d);\n  float d4 = sdf_line(p, d, a);\n\n  if(d1 >= 0.0 && d2 >= 0.0 && d3 >= 0.0 && d4 >= 0.0 ||\n     d1 <= 0.0 && d2 <= 0.0 && d3 <= 0.0 && d4 <= 0.0) {\n    \n    vec2 v1 = b - a;\n    vec2 v2 = d - a;\n    vec2 vp = p - a;\n\n    float l1 = length(v1);\n    float l2 = length(v2);\n    float p1 = dot(vp, v1) / l1;\n    float p2 = dot(vp, v2) / l2;\n\n    float ang = angle(v2, v1);\n    float x = (p1 - abs(d1) / tan(ang));\n    float y = (p2 - abs(d4) / tan(ang));\n\n    x /= l1;\n    y /= l2;\n\n    return vec2(x, y);\n  }\n\n  return vec2(-1.0);\n}\n\nbox2 transform(box2 box, mat3 matrix) {\n  return box2(\n    transform(box.a, matrix),\n    transform(box.b, matrix),\n    transform(box.c, matrix),\n    transform(box.d, matrix)\n  );\n}\n\nbox2 translate(box2 box, vec2 xy) {\n  return box2(\n    translate(box.a, xy), \n    translate(box.b, xy), \n    translate(box.c, xy), \n    translate(box.d, xy)\n  );\n}\n\nbox2 scale(box2 box, vec2 origin, vec2 scaleXY) {\n  return box2(\n    scale(box.a, origin, scaleXY), \n    scale(box.b, origin, scaleXY), \n    scale(box.c, origin, scaleXY), \n    scale(box.d, origin, scaleXY)\n  );\n}\n\nbox2 scale(box2 box, vec2 scaleXY) {\n  return box2(\n    scale(box.a, scaleXY), \n    scale(box.b, scaleXY), \n    scale(box.c, scaleXY), \n    scale(box.d, scaleXY)\n  );\n}\n\nbox2 rotate(box2 box, vec2 origin, float ang) {\n  return box2(\n    rotate(box.a, origin, ang),\n    rotate(box.b, origin, ang),\n    rotate(box.c, origin, ang),\n    rotate(box.d, origin, ang)\n  );\n}\n\nbox2 rotate(box2 box, float ang) {\n  return box2(\n    rotate(box.a, ang),\n    rotate(box.b, ang),\n    rotate(box.c, ang),\n    rotate(box.d, ang)\n  );\n}\n\nbox2 skew(box2 box, vec2 origin, vec2 skewXY) {\n  return box2(\n    skew(box.a, origin, skewXY),\n    skew(box.b, origin, skewXY),\n    skew(box.c, origin, skewXY),\n    skew(box.d, origin, skewXY)\n  );\n}\n\nbox2 skew(box2 box, vec2 skewXY) {\n  return box2(\n    skew(box.a, skewXY),\n    skew(box.b, skewXY),\n    skew(box.c, skewXY),\n    skew(box.d, skewXY)\n  );\n}\n\n#endif",transform:"#ifndef MOD_TRANSFORM\n\n#define MOD_TRANSFORM\n\n/**\n  计算向量和 box 的 transform\n */\nvec2 transform(vec2 v0, mat3 matrix) {\n  return vec2(matrix * vec3(v0, 1.0));\n}\n\nvec2 translate(vec2 v0, vec2 xy) {\n  mat3 m = mat3(1, 0, 0, 0, 1, 0, xy.x, xy.y, 1);\n  return transform(v0, m);\n}\n\nvec2 scale(vec2 v0, vec2 origin, vec2 scale) {\n  mat3 m = mat3(scale.x, 0, 0, 0, scale.y, 0, 0, 0, 1);\n  return transform(v0 - origin, m) + origin;\n}\n\nvec2 scale(vec2 v0, vec2 scaleXY) {\n  return scale(v0, vec2(0.0), scaleXY);\n}\n\nvec2 rotate(vec2 v0, vec2 origin, float ang) {\n  float sinA = sin(ang);\n  float cosA = cos(ang);\n  mat3 m = mat3(cosA, -sinA, 0, sinA, cosA, 0, 0, 0, 1);\n  return transform(v0 - origin, m) + origin;\n}\n\nvec2 rotate(vec2 v0, float ang) {\n  return rotate(v0, vec2(0.0), ang);\n}\n\nvec2 skew(vec2 v0, vec2 origin, vec2 skew) {\n  mat3 m = mat3(1, tan(skew.y), 0, tan(skew.x), 1, 0, 0, 0, 1);\n  return transform(v0 - origin, m) + origin;\n}\n\nvec2 skew(vec2 v0, vec2 skewXY) {\n  return skew(v0, vec2(0.0), skewXY);\n}\n\n#endif",graphics:"#ifndef M_GRAPH\n\n#define M_GRAPH\n\n#pragma include <stdlib>\n#pragma include <shaper>\n#pragma include <transform>\n\n/**\n  有向距离场\n */\n#ifndef SDF\n#define SDF float\n#endif\n\n/**\n  定义： Unit Distance Field 单位距离场，值从 0.0~1.0，无限远处为0.0，最近处为1.0\n  stroke 和 fill 的时候取距离场的切面\n */\n#ifndef UDF\n#define UDF float\n#endif\n\n/**\n  PLOT宏，用来绘制连续函数曲线\n  注意：PLOT适合绘制连续曲线，在局部不连续处可能失真\n\n  参数：\n    function f  曲线方程 y = f(x)\n    vec2 st     当前绘图坐标\n    float step  曲线采样间隔\n    float th    线条宽度\n    float smth  边缘模糊率，用于消除锯齿\n  \n  返回值：\n    UDF  距离场\n*/\n#ifndef PLOT\n#define PLOT(f, st, step) sdf_plot(st, vec2(st.x - step, f(st.x - step)), vec2(st.x, f(st.x)), vec2(st.x + step, f(st.x + step)))\n#endif\n\n#ifndef SPRITE\n#define SPRITE(quad, f) if(quad.x >= 0.0 && quad.x <= 1.0) f(quad);\n#endif\n\n/**\n  点到直线的距离\n */\nSDF sdf_line(vec2 p, vec2 v1, vec2 v2) {\n  vec2 pd = p - v1;\n  vec2 pd2 = p - v2;\n  vec2 seg = v2 - v1;\n\n  return (pd.x * seg.y - pd.y * seg.x) / length(seg);\n}\n\nSDF sdf_line(vec2 p, vec2 v) {\n  return sdf_line(p, vec2(0), v);\n}\n\n/**\n  点到线段的距离\n\n  参数：\n    vec2 p  点坐标\n    vec2 v1 线段端点坐标\n    vec2 v2 线段端点坐标\n\n  返回值：\n    float   距离\n */\nSDF sdf_seg(vec2 p, vec2 v1, vec2 v2) {\n  vec2 pd = p - v1;\n  vec2 pd2 = p - v2;\n  vec2 seg = v2 - v1;\n\n  float l = length(seg);\n  float d = abs(pd.x * seg.y - pd.y * seg.x) / l;\n  float proj = (pd.x * seg.x + pd.y * seg.y) / l;\n\n  if(proj >= 0.0 && proj <= l) return d;\n\n  return min(length(pd), length(pd2));\n}\n\nSDF sdf_seg(vec2 p, vec2 v) {\n  return sdf_seg(p, vec2(0), v);\n}\n\n/**\n  取 p 到线段 v1v2 和 v2v3 两者中最近的距离\n\n  参数：\n    vec2 p 点坐标\n    vec2 v1 线段端点坐标\n    vec2 v2 线段端点坐标\n    vec2 v3 线段端点坐标\n\n  返回值：\n    SDF 距离\n */\nSDF sdf_plot(vec2 p, vec2 v1, vec2 v2, vec2 v3) {\n  float d1 = sdf_seg(p, v1, v2);\n  float d2 = sdf_seg(p, v2, v3);\n\n  return min(d1, d2);\n}\n\nUDF stroke(SDF d, float d0, float w, float smth) {\n  float th = 0.5 * w;\n  smth = smth * w;\n  float start = d0 - th;\n  float end = d0 + th; \n  return smoothstep(start, start + smth, d) - smoothstep(end - smth, end, d);\n}\n\nUDF stroke(SDF d, float w, float smth) {\n  return stroke(d, 0.0, w, smth);\n}\n\nUDF stroke(SDF d, float w) {\n  return stroke(d, 0.0, w, 0.0);\n}\n\n/**\n  三角形的 SDF\n */\nSDF sdf_triangle(vec2 st, vec2 a, vec2 b, vec2 c) {\n  vec2 va = a - b;\n  vec2 vb = b - c;\n  vec2 vc = c - a;\n\n  float d1 = sdf_line(st, a, b);\n  float d2 = sdf_line(st, b, c);\n  float d3 = sdf_line(st, c, a);\n\n  // 三角形内切圆半径\n  float l = abs(va.x * vb.y - va.y * vb.x) / (length(va) + length(vb) + length(vc));\n\n  if(d1 >= 0.0 && d2 >= 0.0 && d3 >= 0.0 || d1 <= 0.0 && d2 <= 0.0 && d3 <= 0.0) {\n    return min(abs(d1), min(abs(d2), abs(d3))) / l;\n  }\n\n  d1 = sdf_seg(st, a, b);\n  d2 = sdf_seg(st, b, c);\n  d3 = sdf_seg(st, c, a);\n  return -min(abs(d1), min(abs(d2), abs(d3))) / l;\n}\n\nSDF sdf_rect(vec2 st, vec2 p, float w, float h) {\n  vec2 a = p;\n  vec2 b = p + vec2(w, 0.0);\n  vec2 c = p + vec2(w, h);\n  vec2 d = p + vec2(0.0, h);\n\n  float d1 = sdf_line(st, a, b);\n  float d2 = sdf_line(st, b, c);\n  float d3 = sdf_line(st, c, d);\n  float d4 = sdf_line(st, d, a);\n\n  float l = min(w, h) * 0.5; // 矩形短边\n\n  if(d1 >= 0.0 && d2 >= 0.0 && d3 >= 0.0 && d4 >= 0.0 ||\n     d1 <= 0.0 && d2 <= 0.0 && d3 <= 0.0 && d4 <= 0.0) {\n    return min(abs(d1), min(abs(d2), min(abs(d3), abs(d4)))) / l;\n  }\n\n  d1 = sdf_seg(st, a, b);\n  d2 = sdf_seg(st, b, c);\n  d3 = sdf_seg(st, c, d);\n  d4 = sdf_seg(st, d, a);\n\n  return -min(abs(d1), min(abs(d2), min(abs(d3), abs(d4)))) / l;\n}\n\nSDF sdf_circle(vec2 st, vec2 c, float r) {\n  return 1.0 - length(st - c) / r;\n}\n\nSDF sdf_ellipse(vec2 st, vec2 c, float a, float b) {\n  vec2 p = st - c;\n  return 1.0 - sqrt(pow(p.x / a, 2.0) + pow(p.y / b, 2.0));\n}\n\nSDF sdf_ellipse(vec2 st, vec2 c, float a, float b, float sAng, float eAng) {\n  vec2 ua = vec2(cos(sAng), sin(sAng));\n  vec2 ub = vec2(cos(eAng), sin(eAng));\n\n  float d1 = sdf_line(st, c, ua + c);\n  float d2 = sdf_line(st, c, ub + c);\n\n  float d3 = sdf_ellipse(st, c, a, b);\n  float r = min(a, b);\n\n  vec2 v = st - c;\n  float ang = angle(v, vec2(1.0, 0));\n\n  if(eAng - sAng > 2.0 * PI) {\n    return d3;\n  }\n\n  if(ang >= sAng && ang <= eAng) { // 两个向量夹角中间的部分\n    float m = max(a, b);\n    float d11 = sdf_seg(st, c, ua * m + c);\n    float d12 = sdf_seg(st, c, ub * m + c);\n    if(d3 >= 0.0) {\n      return min(abs(d11 / r), min(abs(d12 / r), d3));\n    }\n    return d3;\n  }\n  \n  float pa = dot(ua, v); // 求投影\n  float pb = dot(ub, v);\n\n  if(pa < 0.0 && pb < 0.0) {\n    return -length(st - c) / r;\n  }\n\n  if(d1 > 0.0 && pa >= 0.0) {\n    vec2 va = pa * ua;\n    float da = pow(va.x / a, 2.0) + pow(va.y / b, 2.0);\n    if(d3 > 0.0 || da <= pow(1.0 + abs(d1 / r), 2.0)) {\n      return -abs(d1 / r);\n    } else {\n      return d3;\n    }\n  }\n\n  if(d2 < 0.0 && pb >= 0.0) {\n    vec2 vb = pb * ub;\n    float db = pow(vb.x / a, 2.0) + pow(vb.y / b, 2.0);\n    if(d3 >= 0.0 || db <= pow(1.0 + abs(d2 / r), 2.0)) {\n      return -abs(d2 / r);\n    } else {\n      return d3;\n    }\n  }\n}\n\nSDF sdf_arc(vec2 st, vec2 c, float r, float sAng, float eAng) {\n  return sdf_ellipse(st, c, r, r, sAng, eAng);\n}\n\nSDF sdf_rhombus(vec2 st, vec2 cr, float w, float h) {\n  vec2 a = cr - vec2(0.5 * w, 0);\n  vec2 b = cr - vec2(0, 0.5 * h);\n  vec2 c = cr + vec2(0.5 * w, 0);\n  vec2 d = cr + vec2(0, 0.5 * h);\n\n  vec2 va = a - b;\n  vec2 vb = b - c;\n  vec2 vc = c - d;\n  vec2 vd = d - a;\n\n  float d1 = sdf_line(st, a, b);\n  float d2 = sdf_line(st, b, c);\n  float d3 = sdf_line(st, c, d);\n  float d4 = sdf_line(st, d, a);\n\n  float l = min(w, h) * 0.5; // 矩形短边\n\n  if(d1 >= 0.0 && d2 >= 0.0 && d3 >= 0.0 && d4 >= 0.0 ||\n     d1 <= 0.0 && d2 <= 0.0 && d3 <= 0.0 && d4 <= 0.0) {\n    return min(abs(d1), min(abs(d2), min(abs(d3), abs(d4)))) / l;\n  }\n\n  d1 = sdf_seg(st, a, b);\n  d2 = sdf_seg(st, b, c);\n  d3 = sdf_seg(st, c, d);\n  d4 = sdf_seg(st, d, a);\n\n  return -min(abs(d1), min(abs(d2), min(abs(d3), abs(d4)))) / l;  \n}\n\n/**\n  正多边形(含内摆线)\n */\nSDF regular_polygon(vec2 st, vec2 center, float r, float rotation, const int edges, bool hypocycloid) {\n  vec2 p = st - center;\n  vec2 v0 = vec2(0, r); // 第一个顶点\n  v0 = rotate(v0, -rotation);\n\n  float a = 2.0 * PI / float(edges); // 每条边与中心点的夹角\n\n  float ang = angle(v0, p); // 取夹角\n  ang = floor(ang / a); // 在哪个区间\n\n  vec2 v1 = rotate(v0, a * ang); // 左顶点\n  vec2 v2 = rotate(v0, a * (ang + 1.0)); // 右顶点\n\n  float c_a = cos(0.5 * a);\n\n  float l = r * c_a;\n\n  float d = sdf_line(p, v1, v2);\n  \n  if(hypocycloid && d >= 0.0) {\n    vec2 c = (v1 + v2) / 2.0;\n    float r2 = r * tan(0.5 * a);\n    vec2 ce = c / (c_a * c_a); // 外部圆心\n\n    d = (distance(p, ce) - r2) / (length(ce) - r2);\n    return d;\n  }\n  \n  return d / l; \n}\n\nSDF regular_polygon(vec2 st, vec2 center, float r, float rotation, const int edges) {\n  return regular_polygon(st, center, r, rotation, edges, false);\n}\n\nSDF regular_polygon(vec2 st, vec2 center, float r, const int edges, bool hypocycloid) {\n  return regular_polygon(st, center, r, 0.0, edges, true);\n}\n\nSDF regular_polygon(vec2 st, vec2 center, float r, const int edges) {\n  return regular_polygon(st, center, r, 0.0, edges, false);\n}\n\nUDF fill(SDF d, float start, float end, float smth_start, float smth_end) {\n  smth_start = (end - start) * smth_start;\n  smth_end = (end - start) * smth_end;\n  return smoothstep(start, start + smth_start, d) - smoothstep(end - smth_end, end, d);\n}\n\nUDF fill(SDF d, float start, float end, float smth) {\n  return fill(d, start, end, smth, smth);\n}\n\nUDF fill(SDF d, float start, float smth) {\n  return fill(d, start, 1.0, smth, 0.0);\n}\n\nUDF fill(SDF d, float smth) {\n  return fill(d, 0.0, 1.0, smth, 0.0);\n}\n\nUDF fill(SDF d) {\n  return fill(d, 0.0, 1.0, 0.0, 0.0);\n}\n\n/**\n  complement(d1, d2, d3...) = complement(union(d1, d2, d3...), intersect(d1, d2, d3...))\n */\n\nUDF udf_intersect(UDF d1, UDF d2) {\n  if(d1 > 0.0 && d2 > 0.0) {\n    return min(d1, d2);\n  }\n  return 0.0;\n}\n\nUDF udf_union(UDF d1, UDF d2) {\n  if(d1 > 0.0 || d2 > 0.0) {\n    return max(d1, d2);\n  }\n  return 0.0;\n}\n\n// 无法消除锯齿\nUDF udf_complement(UDF d1, UDF d2) {\n  if(d1 > 0.0 && d2 == 0.0 || d1 == 0.0 && d2 > 0.0) return 1.0;\n  return 0.0;\n}\n\n#pragma include <box>\n#pragma include <shapes>\n\n#endif",color:"#ifndef M_COLOR\n\n#define M_COLOR\n\n#ifndef UDF\n#define UDF float\n#endif\n\nvec3 rgb2hsb(vec3 c){\n  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n  vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n  float d = q.x - min(q.w, q.y);\n  float e = 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\n//  Function from Iñigo Quiles\n//  https://www.shadertoy.com/view/MsS3Wc\nvec3 hsb2rgb(vec3 c){\n  vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0), 6.0)-3.0)-1.0, 0.0, 1.0);\n  rgb = rgb * rgb * (3.0 - 2.0 * rgb);\n  return c.z * mix(vec3(1.0), rgb, c.y);\n}\n\nvec4 rgba_color(int r, int g, int b, float a) {\n  return vec4(float(r / 255), float(g / 255), float(b / 255), a);\n}\n\nvec4 rgba_color(float r, float g, float b, float a) {\n  return vec4(r, g, b, a);\n}\n\nvec4 rgba_color(vec4 v) {\n  return v;\n}\n\nvec4 rgba_color(vec3 v, float a) {\n  return vec4(v, a);\n}\n\nvec3 rgb_color(int r, int g, int b) {\n  return rgba_color(r, g, b, 1.0).rgb;\n}\n\nvec3 rgb_color(float r, float g, float b) {\n  return rgba_color(r, g, b, 1.0).rgb;\n}\n\nvec3 rgb_color(vec3 v) {\n  return vec4(v, 1.0).rgb;\n}\n\nvec4 hsba_color(float h, float s, float b, float a) {\n  return vec4(hsb2rgb(vec3(h, s, b)), a);\n}\n\nvec4 hsba_color(vec4 v) {\n  return vec4(hsb2rgb(v.xyz), v.w);\n}\n\nvec4 hsba_color(vec3 v, float a) {\n  return vec4(hsb2rgb(v), a);\n}\n\nvec3 hsb_color(float h, float s, float b) {\n  return hsba_color(h, s, b, 1.0).rgb;\n}\n\nvec3 hsb_color(vec3 v) {\n  return hsba_color(v, 1.0).rgb;\n}\n\n#ifndef RGB\n#define RGB rgb_color\n#endif\n\n#ifndef RGBA\n#define RGBA rgba_color\n#endif\n\n#ifndef HSB\n#define HSB hsb_color\n#endif\n\n#ifndef HSBA\n#define HSBA hsba_color\n#endif\n\n#ifndef WEBGL2\n#define FragColor gl_FragColor\n#else\nout vec4 FragColor;\n#endif\n\nvoid color(UDF d, vec4 c1, vec4 c2) {\n  FragColor = mix(c2, c1, d);\n}\n\nvoid color(UDF d, vec4 c1, vec3 c2) {\n  color(d, c1, vec4(c2, 1.0));\n}\n\nvoid color(UDF d, vec3 c1, vec4 c2) {\n  color(d, vec4(c1, 1.0), c2);\n}\n\nvoid color(UDF d, vec3 c1, vec3 c2) {\n  color(d, vec4(c1, 1.0), vec4(c2, 1.0));\n}\n\nvoid color(UDF d, vec4 c) {\n  color(d, c, FragColor);\n}\n\nvoid color(UDF d, vec3 c) {\n  color(d, vec4(c, 1.0), FragColor);\n}\n\n#endif",pattern:"#ifndef M_PATTERN\n\n#define M_PATTERN\n\n/**\n  创建不重叠的格子，每个格子坐标范围 0.0 ~ 1.0\n */\nvec2 grid_xy(vec2 st, vec2 grid) {\n  return fract(st * grid);\n}\n\n/**\n  创建重叠的格子，每个格子返回坐标范围 -1.0 ~ 1.0\n */\nvoid grid_overlap(vec2 st, vec2 grid, inout vec2 overlap[4]) {\n  vec2 v = fract(st * grid);\n  overlap[0] = v;\n  overlap[1] = v - vec2(1.0, 0.0);\n  overlap[2] = v - vec2(0.0, 1.0);\n  overlap[3] = v - vec2(1.0, 1.0);\n}\n\nvec2 grid_index(vec2 st, vec2 grid) {\n  return floor(st * grid);\n}\n\nbool grid_odd_row(vec2 idx, vec2 grid) {\n  return mod(idx.y, 2.0) != 0.0;\n}\n\nbool grid_even_row(vec2 idx, vec2 grid) {\n  return mod(idx.y, 2.0) == 0.0;\n}\n\nbool grid_odd_col(vec2 idx, vec2 grid) {\n  return mod(idx.x, 2.0) != 0.0;\n}\n\nbool grid_even_col(vec2 idx, vec2 grid) {\n  return mod(idx.x, 2.0) == 0.0;\n}\n\nbool grid_odd(vec2 idx, vec2 grid) {\n  return mod(idx.x, 2.0) != 0.0 && mod(idx.y, 2.0) == 0.0\n    || mod(idx.x, 2.0) == 0.0 && mod(idx.y, 2.0) != 0.0;\n}\n\nbool grid_even(vec2 idx, vec2 grid) {\n  return !grid_odd(idx, grid);\n}\n\n#ifndef OCTAVES\n#define OCTAVES 6\n#endif\n\n/* --- effects --- */\n\n/**\n  云雾\n */\nfloat mist(vec2 st) {\n  //Initial values\n  float value = 0.0;\n  float amplitude = 0.5;\n  float frequency = 0.0;\n\n  // Loop of octaves\n  for(int i = 0; i < OCTAVES; i++) {\n    value += amplitude * noise(st);\n    st *= 2.0;\n    amplitude *= 0.5;\n  }\n  return value;\n}\n\n/**\n  分形\n */\nfloat juila_set(vec2 st, vec2 center, float dist, vec2 c, float scale) {\n  const int max_iterations = 255;\n  vec2 uv = 2.5 * (st - center);\n  int count = max_iterations;\n\n  for(int i = 0; i < max_iterations; i++) {\n    uv = c + vec2(uv.x * uv.x - uv.y * uv.y, uv.x * uv.y * 2.0);\n    if(dot(uv, uv) > 4.0) {\n      count = i;\n      break;\n    }\n  }\n  return float(count) * scale;\n}\n\n#endif",shapes:"#ifndef MOD_SHAPES\n\n#define MOD_SHAPES\n\n/** \n  小图形\n */\nUDF shape_blade(vec2 st, vec2 center, float num) {\n  vec2 pt = polar(st, vec2(center));\n  float x = pt.x;\n  float y = cos(pt.y * num);\n  return smoothstep(x - 0.01, x + 0.01, y);  \n}\n\nUDF shape_blade3(vec2 st, vec2 center) {\n  return shape_blade(st, center, 3.0);\n}\n\nUDF shape_blade3(vec2 st) {\n  return shape_blade(st, vec2(0.5), 3.0);\n}\n\nUDF shape_blade4(vec2 st, vec2 center) {\n  return shape_blade(st, center, 4.0);\n}\n\nUDF shape_blade4(vec2 st) {\n  return shape_blade(st, vec2(0.5), 4.0);\n}\n\nUDF shape_blade5(vec2 st, vec2 center) {\n  return shape_blade(st, center, 5.0);\n}\n\nUDF shape_blade5(vec2 st) {\n  return shape_blade(st, vec2(0.5), 5.0);\n}\n\nUDF shape_infinity(vec2 st, vec2 center) {\n  return shape_blade(st, center, 2.0);\n}\n\nUDF shape_infinity(vec2 st) {\n  return shape_blade(st, vec2(0.5), 2.0);\n}\n\nUDF shape_clover(vec2 st, vec2 center, float num) {\n  vec2 pt = polar(st, vec2(center));\n  float x = pt.x;\n  float y = abs(cos(pt.y * num * 0.5));\n  return smoothstep(x - 0.01, x + 0.01, y);  \n}\n\nUDF shape_bean(vec2 st, vec2 center) {\n  return shape_clover(st, center, 1.0);\n}\n\nUDF shape_bean(vec2 st) {\n  return shape_clover(st, vec2(0.5), 1.0);\n}\n\nUDF shape_apple(vec2 st, vec2 center) {\n  return shape_clover(vec2(st.y - 0.2, st.x), center, 1.3);\n}\n\nUDF shape_apple(vec2 st) {\n  return shape_clover(vec2(st.y - 0.2, st.x), vec2(0.5), 1.3);\n}\n\nUDF shape_clover3(vec2 st, vec2 center) {\n  return shape_clover(st, center, 3.0);\n}\n\nUDF shape_clover3(vec2 st) {\n  return shape_clover(st, vec2(0.5), 3.0);\n}\n\nUDF shape_clover4(vec2 st, vec2 center) {\n  return shape_clover(st, center, 4.0);\n}\n\nUDF shape_clover4(vec2 st) {\n  return shape_clover(st, vec2(0.5), 4.0);\n}\n\nUDF shape_clover5(vec2 st, vec2 center) {\n  return shape_clover(st, center, 5.0);\n}\n\nUDF shape_clover5(vec2 st) {\n  return shape_clover(st, vec2(0.5), 5.0);\n}\n\nUDF shape_flower(vec2 st, vec2 center, float num) {\n  vec2 pt = polar(st, vec2(center));\n  float x = pt.x;\n  float y = abs(cos(pt.y * num * 0.5)) * 0.5 + 0.3;\n  return smoothstep(x - 0.01, x + 0.01, y);  \n}\n\nUDF shape_gourd(vec2 st, vec2 center) {\n  return shape_flower(vec2(st.y, st.x), center, 1.7);\n}\n\nUDF shape_gourd(vec2 st) {\n  return shape_flower(vec2(st.y, st.x), vec2(0.5), 1.7);\n}\n\nUDF shape_flower3(vec2 st, vec2 center) {\n  return shape_flower(st, center, 3.0);\n}\n\nUDF shape_flower3(vec2 st) {\n  return shape_flower(st, vec2(0.5), 3.0);\n}\n\nUDF shape_flower4(vec2 st, vec2 center) {\n  return shape_flower(st, center, 4.0);\n}\n\nUDF shape_flower4(vec2 st) {\n  return shape_flower(st, vec2(0.5), 4.0);\n}\n\nUDF shape_flower5(vec2 st, vec2 center) {\n  return shape_flower(st, center, 5.0);\n}\n\nUDF shape_flower5(vec2 st) {\n  return shape_flower(st, vec2(0.5), 5.0);\n}\n\nUDF shape_bud(vec2 st, vec2 center, float num) {\n  vec2 pt = polar(st, vec2(center));\n  float x = pt.x;\n  float y = smoothstep(-0.5, 1.0, cos(pt.y * num)) * 0.2 + 0.5;\n  return smoothstep(x - 0.01, x + 0.01, y);  \n}\n\nUDF shape_bud5(vec2 st, vec2 center) {\n  return shape_bud(st, center, 5.0);\n}\n\nUDF shape_bud5(vec2 st) {\n  return shape_bud(st, vec2(0.5), 5.0);\n}\n\nUDF shape_bud8(vec2 st, vec2 center) {\n  return shape_bud(st, center, 8.0);\n}\n\nUDF shape_bud8(vec2 st) {\n  return shape_bud(st, vec2(0.5), 8.0);\n}\n\nUDF shape_bud10(vec2 st, vec2 center) {\n  return shape_bud(st, center, 10.0);\n}\n\nUDF shape_bud10(vec2 st) {\n  return shape_bud(st, vec2(0.5), 10.0);\n}\n\nUDF shape_bud12(vec2 st, vec2 center) {\n  return shape_bud(st, center, 12.0);\n}\n\nUDF shape_bud12(vec2 st) {\n  return shape_bud(st, vec2(0.5), 12.0);\n}\n\n// TODO: 处理锯齿\nUDF shape_star(vec2 st, vec2 center) {\n  float r = 0.45;\n  float d = regular_polygon(st, center, r, 5);\n  float a = -2.0 * PI / 5.0;\n\n  d = fill(d, 0.01);\n\n  vec2 v0 = vec2(0, r);\n  \n  for(int i = 0; i < 5; i++) {\n    vec2 v1 = rotate(v0, float(i) * a);\n    vec2 v2 = rotate(v0, float(i + 1) * a);\n    float l = length(v2 - v1);\n\n    float c = 0.5 / cos(PI / 5.0);\n\n    vec2 p = rotate(v2, v1, -PI / 5.0);\n    p += (1.0 - c) * (v1 - p);\n\n    float d2 = sdf_triangle(st - center, v1, v2, p);\n\n    d2 = fill(d2, 0.01);\n\n    d = udf_complement(d, d2);\n  }\n\n  return d;\n}\n\nUDF shape_regular_polygon(vec2 st, vec2 center, const int edges) {\n  float d = regular_polygon(st, center, 0.45, edges);\n  return fill(d, 0.01);\n}\n\nUDF shape_star(vec2 st) {\n  return shape_star(st, vec2(0.5));\n}\n\nUDF shape_triangle(vec2 st, vec2 center) {\n  return shape_regular_polygon(st, center, 3);\n}\n\nUDF shape_triangle(vec2 st) {\n  return shape_regular_polygon(st, vec2(0.5), 3);\n}\n\nUDF shape_rhombus(vec2 st, vec2 center) {\n  return shape_regular_polygon(st, center, 4);\n}\n\nUDF shape_rhombus(vec2 st) {\n  return shape_regular_polygon(st, vec2(0.5), 4);\n}\n\nUDF shape_pentagon(vec2 st, vec2 center) {\n  return shape_regular_polygon(st, center, 5);\n}\n\nUDF shape_pentagon(vec2 st) {\n  return shape_regular_polygon(st, vec2(0.5), 5);\n}\n\nUDF shape_hexagon(vec2 st, vec2 center) {\n  return shape_regular_polygon(st, center, 6);\n}\n\nUDF shape_hexagon(vec2 st) {\n  return shape_regular_polygon(st, vec2(0.5), 6);\n}\n\nUDF shape_heptagon(vec2 st, vec2 center) {\n  return shape_regular_polygon(st, center, 7);\n}\n\nUDF shape_heptagon(vec2 st) {\n  return shape_regular_polygon(st, vec2(0.5), 7);\n}\n\nUDF shape_octagon(vec2 st, vec2 center) {\n  return shape_regular_polygon(st, center, 8);\n}\n\nUDF shape_octagon(vec2 st) {\n  return shape_regular_polygon(st, vec2(0.5), 8);\n}\n\nUDF shape_hypocycloid(vec2 st, vec2 center, const int edges) {\n  float d = regular_polygon(st, center, 0.45, edges, true);\n  return fill(d, 0.01);\n}\n\nUDF shape_hypocycloid(vec2 st, const int edges) {\n  return shape_hypocycloid(st, vec2(0.5), edges);\n}\n\nUDF shape_cross(vec2 st, vec2 center, float w, float h) {\n  vec2 p1 = center - 0.5 * vec2(w, h);\n  vec2 p2 = center - 0.5 * vec2(h, w);\n  float d1 = sdf_rect(st, p1, w, h);\n  float d2 = sdf_rect(st, p2, h, w);\n  return fill(udf_union(d1, d2), 0.01);\n}\n\nUDF shape_cross(vec2 st, vec2 center) {\n  return shape_cross(st, center, 0.8, 0.2);\n}\n\nUDF shape_cross(vec2 st, float w, float h) {\n  return shape_cross(st, vec2(0.5), w, h);\n}\n\nUDF shape_cross(vec2 st) {\n  return shape_cross(st, vec2(0.5), 0.8, 0.2);\n}\n\n#endif",shaper:"#ifndef M_SHAPER\n\n#define M_SHAPER\n\n/**\n  declare shaping functions\n */\n\nfloat quadratic_bezier (float x, float a, float b){\n// adapted from BEZMATH.PS (1993)\n// by Don Lancaster, SYNERGETICS Inc. \n// http://www.tinaja.com/text/bezmath.html\n\n  float epsilon = 0.00001;\n  a = max(0.0, min(1.0, a)); \n  b = max(0.0, min(1.0, b)); \n  if (a == 0.5){\n    a += epsilon;\n  }\n\n  // solve t from x (an inverse operation)\n  float om2a = 1.0 - 2.0 * a;\n  float t = (sqrt(a * a + om2a * x) - a) / om2a;\n  float y = (1.0 - 2.0 * b) * (t * t) + (2.0 * b) * t;\n  return y;\n}\n\n// http://www.flong.com/texts/code/shapers_bez/\n// Helper functions:\nfloat slope_from_t (float t, float A, float B, float C){\n  float dtdx = 1.0/(3.0*A*t*t + 2.0*B*t + C); \n  return dtdx;\n}\n\nfloat x_from_t (float t, float A, float B, float C, float D){\n  float x = A*(t*t*t) + B*(t*t) + C*t + D;\n  return x;\n}\n\nfloat y_from_t (float t, float E, float F, float G, float H){\n  float y = E*(t*t*t) + F*(t*t) + G*t + H;\n  return y;\n}\n\nfloat cubic_bezier (float x, float a, float b, float c, float d){\n  float y0a = 0.00; // initial y\n  float x0a = 0.00; // initial x \n  float y1a = b;    // 1st influence y   \n  float x1a = a;    // 1st influence x \n  float y2a = d;    // 2nd influence y\n  float x2a = c;    // 2nd influence x\n  float y3a = 1.00; // final y \n  float x3a = 1.00; // final x \n\n  float A = x3a - 3.0 *x2a + 3.0 * x1a - x0a;\n  float B = 3.0 * x2a - 6.0 * x1a + 3.0 * x0a;\n  float C = 3.0 * x1a - 3.0 * x0a;   \n  float D = x0a;\n\n  float E = y3a - 3.0 * y2a + 3.0 * y1a - y0a;    \n  float F = 3.0 * y2a - 6.0 * y1a + 3.0 * y0a;             \n  float G = 3.0 * y1a - 3.0 * y0a;             \n  float H = y0a;\n\n  // Solve for t given x (using Newton-Raphelson), then solve for y given t.\n  // Assume for the first guess that t = x.\n  float currentt = x;\n  const int nRefinementIterations = 5;\n  for (int i=0; i < nRefinementIterations; i++){\n    float currentx = x_from_t(currentt, A,B,C,D); \n    float currentslope = slope_from_t(currentt, A,B,C);\n    currentt -= (currentx - x)*(currentslope);\n    currentt = clamp(currentt, 0.0, 1.0);\n  } \n\n  float y = y_from_t(currentt, E,F,G,H);\n  return y;\n}\n\n#endif",shadertoy:"#ifndef M_SHADERTOY\n\n#define M_SHADERTOY\n\n// https://www.shadertoy.com/howto\n\n#define iResolution vec3(dd_resolution,0)\n#define iTime dd_time\n#define iTimeDelta dd_timeDelta\n// #define iTimeDelta\n#define iFrame dd_frameIndex\n// #define iChannelTime\n#define iMouse dd_mouseRec\n// #define iDate\n// #define iSampleRate\n// #define iChannelResolution\n#define iChannel0 dd_sampler0\n#define iChannel1 dd_sampler1\n#define iChannel2 dd_sampler2\n#define iChannel3 dd_sampler3\n\nuniform float dd_time;\nuniform float dd_timeDelta;\nuniform int dd_frameIndex;\nuniform vec2 dd_resolution;\nuniform vec4 dd_mouseRec;\n\n#endif"});var N=Symbol("eventHandlers"),j=Symbol("eventUniforms");function G(e,n){var t=n.target.getBoundingClientRect(),r=t.left,o=t.top,a=n.changedTouches?n.changedTouches[0]:n,i=a.clientX,s=a.clientY;return[(i-r)/e.clientWidth,1-(s-o)/e.clientHeight]}function H(e){var n=e._fbos;n&&n.forEach((function(n){var t=w()(n,2),r=t[0],o=t[1],a="dd_sampler".concat(r);a in e.uniforms&&(e.uniforms[a]=o.texture)}))}var Y=function(e){p()(a,e);var n,t,r=M(a);function a(){return c()(this,a),r.apply(this,arguments)}return u()(a,[{key:"compile",value:(t=i()(D.a.mark((function e(n,t){var r,o,s,c,d=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.options.shadertoy&&(n="#version 300 es\n#define WEBGL2\n\nprecision highp float;\nprecision highp int;\n\n#pragma include <shadertoy>\n\n".concat(n,"\n"),r="",/^\s*out\s+vec4\s+FragColor/gm.test(n)||(r="out vec4 FragColor;"),n="".concat(n,"\n").concat(r,"\n\nvoid main() {\n  mainImage(FragColor, gl_FragCoord.xy);\n}")),e.next=4,f()(b()(a.prototype),"compile",this).call(this,n,t);case 4:if(o=e.sent,s=o.shaderText.fragmentShader,!(c=s.match(/^#pragma\s+texture\s+.*/gm))){e.next=11;break}return e.next=10,Promise.all(c.map(function(){var e=i()(D.a.mark((function e(n,r){var a,i,s,c;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.match(/^#pragma\s+texture\s+(.*)/),!/\.(glsl|frag)|^#.+$/.test(a[1])){e.next=27;break}if(d._fbos=d._fbos||{},d._fbosList=d._fbosList||[],i=d._fbos[a[1]]){e.next=24;break}if(e.t0=d.createFBO(),e.t1=d.createFBO(),e.t2=function(){var e=this.writeFBO;this.writeFBO=this.readFBO,this.readFBO=e},i={readFBO:e.t0,writeFBO:e.t1,get texture(){return this.readFBO.texture},swap:e.t2},d._fbos[a[1]]=i,!/^#/.test(a[1])){e.next=15;break}e.t3=document.querySelector(a[1]).textContent,e.next=18;break;case 15:return e.next=17,C.fetchShader(a[1]);case 17:e.t3=e.sent;case 18:return s=e.t3,e.next=21,d.compile(s,t);case 21:c=e.sent,i._program=c,d._fbosList.push(i);case 24:return o._fbos=o._fbos||[],o._fbos.push([r,i]),e.abrupt("return",null);case 27:return e.abrupt("return",d.loadTexture(a[1]));case 28:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()));case 10:this._preloadedTextures=e.sent;case 11:return e.abrupt("return",o);case 12:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"loadTexture",value:(n=i()(D.a.mark((function e(n){var t,r,o,i,s=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>1&&void 0!==s[1]?s[1]:{},r=t.useImageBitmap,o=void 0===r||r,e.next=3,a.loadImage(n,{useImageBitmap:o});case 3:return i=e.sent,e.abrupt("return",this.createTexture(i,{wrapS:this.gl.REPEAT,wrapT:this.gl.REPEAT}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setFeebackContext",value:function(){if(!this.options.preserveDrawingBuffer)throw new Error("Must set preserveDrawingBuffer to true while using feedback mode.");var e;this.feedbackContext||(e="function"==typeof OffscreenCanvas?new OffscreenCanvas(this.canvas.width,this.canvas.height):this.canvas.cloneNode(),this.feedbackContext=e.getContext("2d"))}},{key:"useProgram",value:function(e,n){var t=this,r=this.gl.canvas;if(f()(b()(a.prototype),"useProgram",this).call(this,e,n),this._preloadedTextures&&(this._preloadedTextures.forEach((function(n,t){if(n&&n._img){var r="dd_sampler".concat(t);r in e.uniforms&&(e.uniforms[r]=n)}})),delete this._preloadedTextures),!e._init){e._init=!0;var o=e.uniforms;"dd_frameIndex"in o&&(o.dd_frameIndex=0),"dd_randseed0"in o&&(o.dd_randseed0=[Math.random(),Math.random()]),"dd_randseed"in o&&(o.dd_randseed=o.dd_randseed0||[Math.random(),Math.random()]),"dd_resolution"in o&&(o.dd_resolution=[r.width,r.height]),"dd_samplerFeedback"in o&&this.setFeebackContext()}this[N]=this[N]||[],this[j]=this[j]||{};var i=this[j];if(!("dd_mouseRec"in i)&&"dd_mouseRec"in e.uniforms){i.dd_mouseRec=[-1,-1,0,0];var s=function(e){var n=G(r,e),o=w()(n,2),a=o[0],s=o[1];a*=r.width,s*=r.height,i.dd_mouseRec=[a,s,a,s],t.update()},c=function(e){var n=G(r,e),o=w()(n,2),a=o[0],s=o[1];if(a*=r.width,s*=r.height,e.buttons){var c=i.dd_mouseRec;i.dd_mouseRec=[a,s,c[2],c[3]],t.update()}},d=function(e){var n=i.dd_mouseRec;i.dd_mouseRec=[n[0],n[1],-Math.abs(n[2]),n[3]],t.update()};r.addEventListener("mousemove",c),r.addEventListener("mousedown",s),r.addEventListener("mouseup",d),this[N].push({event:"mousemove",mousemove:c},{event:"mousedown",mousedown:s},{event:"mouseup",mouseup:d})}if(!("dd_mousePosition"in i)&&"dd_mousePosition"in e.uniforms){i.dd_mousePosition=[-1,-1,0,0];var u=function(e){var n=G(r,e),o=w()(n,2),a=o[0],s=o[1];i.dd_mousePosition=[a,s,e.buttons,0],t.update()},l=function(e){i.dd_mousePosition=[-1,-1,0,0],t.update()},v=function(e){var n=G(r,e),o=w()(n,2),a=o[0],s=o[1];i.dd_mousePosition=[a,s,e.buttons,e.buttons],t.update()};r.addEventListener("mousemove",u),r.addEventListener("mouseleave",l),r.addEventListener("mousedown",v),r.addEventListener("mouseup",v),this[N].push({event:"mousemove",mousemove:u},{event:"mouseleave",mouseleave:l},{event:"mousedown",mousedown:v},{event:"mouseup",mouseup:function(e){var n=G(r,e),o=w()(n,2),a=o[0],s=o[1];i.dd_mousePosition=[a,s,0,0],t.update()}})}if(!("dd_mouseDown"in i)&&"dd_mouseDown"in e.uniforms){i.dd_mouseDown=[-1,-1,0];var p=function(e){var n=G(r,e),o=w()(n,2),a=o[0],s=o[1];i.dd_mouseDown=[a,s,e.buttons],t.update()},h=function(e){i.dd_mouseDown[2]=e.buttons,t.update()};r.addEventListener("mousedown",p),r.addEventListener("mouseup",h),this[N].push({event:"mousedown",mousedown:p},{event:"mouseup",mouseup:h})}if(!("dd_keyEvent"in i)&&"dd_keyEvent"in e.uniforms){i.dd_keyEvent=[0,0];var m=function(e){i.dd_keyEvent=[e.keyCode,1],t.update()},_=function(e){i.dd_keyEvent=[e.keyCode,2],t.update()};document.addEventListener("keydown",m),document.addEventListener("keyup",_),this[N].push({event:"keydown",keydown:m},{event:"keyup",keyup:_})}if(!("dd_touchEvent"in i)&&"dd_touchEvent"in e.uniforms){i.dd_touchEvent=[-1,-1,0];var g=function(e){var n=G(r,e),o=w()(n,2),a=o[0],s=o[1];i.dd_touchEvent=[a,s,1],t.update()},x=function(e){var n=G(r,e),o=w()(n,2),a=o[0],s=o[1];i.dd_touchEvent=[a,s,2],t.update()},y=function(e){i.dd_touchEvent[2]=3,t.update()};r.addEventListener("touchstart",g),r.addEventListener("touchmove",x),r.addEventListener("touchend",y),this[N].push({event:"touchstart",touchstart:g},{event:"touchmove",touchmove:x},{event:"touchend",touchend:y})}return e}},{key:"render",value:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.program;!t&&r._fbos&&(this._fbosList.forEach((function(t){var r=t._program;n.useProgram(r),n.bindFBO(t.writeFBO),H(r),n.setMeshData(r.meshData),n.render(e,!0),t.swap()})),this.useProgram(r),this.bindFBO(null),H(r),this.setMeshData(r.meshData)),this.lastRenderTime=this.lastRenderTime||0,this.startRenderTime||(this.startRenderTime=Date.now());var i=(Date.now()-this.startRenderTime)/1e3,s=i-this.lastRenderTime;this.lastRenderTime=i;var c=this.uniforms,d=this.gl,u=!1;"dd_time"in c&&(c.dd_time=i,u=!0),"dd_timeDelta"in c&&(c.dd_timeDelta=s);var l,v=this[j];if("dd_mousePosition"in c){var p=v.dd_mousePosition;c.dd_mousePosition=o()(p),t||(p[3]=0)}if("dd_mouseRec"in c){var h=v.dd_mouseRec;c.dd_mouseRec=o()(h),t||(h[3]=-Math.abs(h[3]))}if("dd_mouseDown"in c){var m=v.dd_mouseDown;c.dd_mouseDown=o()(m)}if("dd_keyEvent"in c){var _=v.dd_keyEvent;c.dd_keyEvent=o()(_),t||2!==_[1]||(_[1]=0)}if("dd_touchEvent"in c){var g=v.dd_touchEvent;c.touchEvent=o()(g),t||3!==g[2]||(g[2]=0)}if("dd_samplerFeedback"in c){var x=this.feedbackContext;x.canvas.width=d.canvas.width,x.canvas.height=d.canvas.height,x.drawImage(d.canvas,0,0),l=this.createTexture(x.canvas),c.dd_samplerFeedback=l}f()(b()(a.prototype),"render",this).call(this),l&&d.deleteTexture(l),"dd_frameIndex"in c&&(c.dd_frameIndex++,u=!0),"dd_randseed"in c&&(c.dd_randseed=[Math.random(),Math.random()],u=!0),u&&this.update()}}],[{key:"autoLoad",value:function(){function e(){document.querySelectorAll("glsl-doodle").forEach(function(){var e=i()(D.a.mark((function e(n){var t,r,o,i,s,c,d,u,l,f,v,p,h,m;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.getAttribute("loaded")){e.next=2;break}return e.abrupt("return");case 2:if(t=n,n.attachShadow?t=n.attachShadow({mode:"open"}):n.createShadowRoot&&(t=n.createShadowRoot()),(r=document.createElement("canvas")).width=n.getAttribute("width")||512,r.height=n.getAttribute("height")||512,r.setAttribute("part","doodle"),t.appendChild(r),n.setAttribute("loaded","loaded"),(o=document.createElement("style")).textContent=":host {\n  display: block;\n}\ncanvas {\n  max-width: 100%;\n  max-height: 100%;\n}",t.appendChild(o),i=n.getAttribute("fragment-for")||n.getAttribute("for"),s=n.getAttribute("vertex-for"),c=null,d=null,!i){e.next=21;break}c=document.getElementById(i).textContent,e.next=26;break;case 21:return u=n.getAttribute("fragment-src")||n.getAttribute("src")||"./index.glsl",e.next=24,C.fetchShader(u);case 24:c=e.sent,/\.js$/.test(u)&&new Function("shader",c)((function(e){c=e.join("")}));case 26:if(!s){e.next=30;break}d=s.textContent,e.next=35;break;case 30:if(!(l=n.getAttribute("vert-src"))){e.next=35;break}return e.next=34,C.fetchShader(l);case 34:d=e.sent;case 35:return f=n.hasAttribute("shadertoy")&&"false"!==n.getAttribute("shadertoy"),!(v=f)&&d&&/^\s*#version\s+300\s+es/gm.test(d)&&(v=!0),!v&&c&&/^\s*#version\s+300\s+es/gm.test(c)&&(v=!0,/^\s*#define\s+WEBGL2/gm.test(c)||(c=c.replace(/^(\s*#version\s+300\s+es)/gm,"$1\n#define WEBGL2\n"))),p=new a(r,{webgl2:v,shadertoy:f}),e.next=42,p.compile(c,d);case 42:h=e.sent,p.useProgram(h),p.render(),m=new CustomEvent("load",{detail:{doodle:p}}),n.dispatchEvent(m),n._doodle=p;case 48:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())}e(),window.addEventListener("DOMContentLoaded",e)}}]),a}(C);x()(Y,"defaultOptions",{preserveDrawingBuffer:!0})}]).default}));